(()=>{{let t=chrome.runtime.getManifest().content_scripts.filter(o=>o.js.includes("eventhook.js")).map(o=>o.matches);chrome.scripting.getRegisteredContentScripts().then(o=>{o.length||chrome.scripting.registerContentScripts([{id:"1",matches:t.flat(),js:["eventhook/loader.js"],allFrames:!0,runAt:"document_start",world:"MAIN"}])})}var s=chrome;var w="https://api.nopecha.com",n="https://www.nopecha.com",$="https://developers.nopecha.com",m={doc:{url:$,automation:{url:`${$}/guides/extension_advanced/#automation-build`}},api:{url:w,recognition:{url:`${w}/recognition`},status:{url:`${w}/status`}},www:{url:n,annoucement:{url:`${n}/json/announcement.json`},demo:{url:`${n}/demo`,hcaptcha:{url:`${n}/demo/hcaptcha`},recaptcha:{url:`${n}/demo/recaptcha`},funcaptcha:{url:`${n}/demo/funcaptcha`},awscaptcha:{url:`${n}/demo/awscaptcha`},textcaptcha:{url:`${n}/demo/textcaptcha`},turnstile:{url:`${n}/demo/turnstile`},perimeterx:{url:`${n}/demo/perimeterx`},geetest:{url:`${n}/demo/geetest`},lemincaptcha:{url:`${n}/demo/lemincaptcha`}},manage:{url:`${n}/manage`},pricing:{url:`${n}/pricing`},setup:{url:`${n}/setup`}},discord:{url:`${n}/discord`},github:{url:`${n}/github`,release:{url:`${n}/github/release`}}};var z="en-US",Q="en";{let e=function(t,o,r,a){return{id:a,priority:1,action:{type:"redirect",redirect:{transform:{queryTransform:{addOrReplaceParams:[{key:t,value:o}]}}}},condition:{regexFilter:r,resourceTypes:["sub_frame"]}}};s.declarativeNetRequest.updateDynamicRules({addRules:[e("hl",z,"^https?://[^\\.]*\\.(google\\.com|recaptcha\\.net)/recaptcha",1),e("lang",Q,"^https?://[^\\.]*\\.(funcaptcha\\.com?|arkoselabs\\.c(om|n)|arkose\\.com\\.cn)/fc/gc/",2)],removeRuleIds:[1,2]})}var l=new Map;chrome.tabs.onUpdated.addListener((e,t)=>{l.has(e)&&!("url"in t)||l.set(e,new Set)});chrome.tabs.onRemoved.addListener(e=>{l.delete(e)});async function T([e],t){let o=t.tab?.id;if(!o)return console.warn("[@nope/background/tabs] unable to figure out tabId");l.has(o)||l.set(o,new Set),l.get(o).add(e)}async function C(){let e=await new Promise(t=>{s.tabs.query({active:!0,currentWindow:!0},([o])=>{t(o)})});return l.has(e.id)?[...l.get(e.id)]:[]}var f={version:18,key:"",keys:[],enabled:!0,disabled_hosts:[],awscaptcha_auto_open:!1,awscaptcha_auto_solve:!1,awscaptcha_solve_delay_time:1e3,awscaptcha_solve_delay:!0,geetest_auto_open:!1,geetest_auto_solve:!1,geetest_solve_delay_time:1e3,geetest_solve_delay:!0,funcaptcha_auto_open:!0,funcaptcha_auto_solve:!0,funcaptcha_solve_delay_time:1e3,funcaptcha_solve_delay:!0,hcaptcha_auto_open:!0,hcaptcha_auto_solve:!0,hcaptcha_solve_delay_time:3e3,hcaptcha_solve_delay:!0,lemincaptcha_auto_open:!1,lemincaptcha_auto_solve:!1,lemincaptcha_solve_delay_time:1e3,lemincaptcha_solve_delay:!0,perimeterx_auto_solve:!1,perimeterx_solve_delay_time:1e3,perimeterx_solve_delay:!0,recaptcha_auto_open:!0,recaptcha_auto_solve:!0,recaptcha_solve_delay_time:2e3,recaptcha_solve_delay:!0,textcaptcha_auto_solve:!1,textcaptcha_image_selector:"",textcaptcha_input_selector:"",textcaptcha_solve_delay_time:100,textcaptcha_solve_delay:!0,turnstile_auto_solve:!0,turnstile_solve_delay_time:1e3,turnstile_solve_delay:!0};var h=s.action,k=!0;function x(e){if(e===k)return;k=e;let t=e?"":"g",o=[new Promise(r=>{h.setIcon({path:Object.fromEntries([16,32,48,128].map(a=>[a,`/icon/${a}${t}.png`]))},r)})];return y&&o.push(new Promise(r=>{h.setBadgeText({text:e?y:""},r)})),Promise.all(o)}var y="";function _(e,t){if(e!==y)return y=e,Promise.all([new Promise(o=>{if(!k)return o();h.setBadgeText({text:e},o)}),new Promise(o=>{h.setBadgeBackgroundColor({color:t},o)})])}function D(e,t){return t.tab.url}function S(){return new Promise(e=>{s.tabs.query({active:!0,currentWindow:!0},([t])=>e(t))})}async function g(){return(await S()).id}async function U(){let e=await S();return e&&e.url&&new URL(e.url).href}async function j(){let e=await S();return JSON.stringify(e)}var R=new Set,P=new Set;s.runtime.onConnect.addListener(e=>{e.name==="stream"?(R.add(e),e.onDisconnect.addListener(()=>{R.delete(e)})):e.name==="broadcast"&&(P.add(e),e.onDisconnect.addListener(()=>{P.delete(e)}))});function q(e){R.forEach(t=>t.postMessage(e))}async function J(e){let t=await g();e={data:e,event:"broadcast"},P.forEach(o=>{o.sender?.tab?.id!==void 0&&t===o.sender?.tab?.id&&o.postMessage(e)})}var B=new Promise(e=>{{let t=s.runtime.getManifest().nopecha;return e({...f,...t})}s.storage.local.get("settings",t=>{if(!t?.settings)return e(f);let{settings:o}=t;o.version!==f.version&&(o={...f,key:o.key}),o.enabled||x(!1),e(o)})});function v(){return B}async function N(e){console.error("cannot update settings when using automation")}function M(){let e;return t=>e||(e=t().finally(()=>e=void 0),e)}var F,Y=M();function I(){return Y(()=>ee())}async function O(){return F}var Z=s.runtime.getManifest().version;async function ee(){let e=new URLSearchParams;e.append("v",Z);let t=(await v()).key;if(t&&e.append("key",t),!t)return _("ERR","#FDE047"),{error:-2,message:"Subscription key not found."};let o=`${m.api.status.url}?${e.toString()}`,r,a=null;try{a=await fetch(o),r=await a.json()}catch(i){console.error("[@nope/background/api/status] failed to fetch status",a,i),r={error:-1,message:a?a.status===522?"Server not responding":a.status===502?"Server has routing issues":`Unknown server error: ${a.status}`:"Server connection failure."}}return a&&!a.ok&&(!r||!("error"in r))&&(console.error("[@nope/background/api/status] received non 2xx",a,r),r={error:-1,message:`Server error: ${a.status}`}),F=r,"error"in r?_("ERR","#FDE047"):typeof r.credit=="number"&&typeof r.quota=="number"?_(r.credit>=9999?`${Math.floor(r.credit/r.quota*100)}`:r.credit.toString(),r.credit?"#0a95ff":"#FB7185"):_("","#fff0"),r}I();function b(e){return new Promise(t=>setTimeout(t,e))}function A(e,t=2166136261){let o=t;for(let r of e)o^=r,o+=o<<1;return o>>>0}var te=[];function E(){return JSON.stringify(te)}var oe=[15,16,12,10,17];async function H(e){let t=new Headers;t.append("accept","application/json"),t.append("content-type","application/json");let o=typeof e.v=="string"?A(e.v.split("").map(c=>c.charCodeAt(0))):-1;if(e.key&&e.key!=="undefined")t.append("authorization",`Bearer ${e.key}`);else return{error:-2,message:"Unknown error occured"};let r;for(let c=30;c>0&&o===2860377008;c--){let d=(m.api.url,void 0),u=await fetch(m.api.url,{method:"POST",headers:t,body:JSON.stringify(e)});if(u.status>=500){await b(1e3);continue}let p=await u.json();if("error"in p){if(oe.includes(p.error))return p;p.error!==11&&console.warn("[@nope/background/api/recognition] unknown error",p),await b(1e3)}else{r=p.data;break}}if(!r)return{error:-1,message:"Server timeout"};t.delete("content-type");let a,i=`${m.api.url}?id=${r}&key=${e.key}`;for(let c=60;c>0;c--){a=void 0;let d=await fetch(i,{headers:t});if(d.status>=500){await b(1e3);continue}let u=await d.json();if("error"in u)u.error!==14&&console.warn("[@nope/background/api/recognition] unknown error",u),await b(1e3);else return u}return a&&void 0,{error:-1,message:"Server timeout"}}async function V([e,t]){let o=await fetch(e,t);return{headers:Object.fromEntries(o.headers.entries()),status:o.status,ok:o.ok,text:await o.text()}}async function W([e,t]){let o=await fetch(e,t),r=await o.blob(),a=new FileReader;return await new Promise(i=>{a.addEventListener("load",i),a.readAsDataURL(r)}),{headers:Object.fromEntries(o.headers.entries()),status:o.status,ok:o.ok,data:a.result}}function L(e){let t=("07f8dc4485c03e04c4cc386e3a2f5bfff03b4e3ddff7b84ab0aa8ae1554ca22c"+e).split("").map(o=>o.charCodeAt(0));return K(t)}var G=new Uint32Array(256);for(let e=256;e--;){let t=e;for(let o=8;o--;)t=t&1?3988292384^t>>>1:t>>>1;G[e]=t}function K(e){let t=-1;for(let o of e)t=t>>>8^G[t&255^o];return(t^-1)>>>0}async function X(e){!e&&(e=await g(),!e)||chrome.scripting.executeScript({target:{tabId:e,allFrames:!0},files:["lib/selector.js","locate.js"],world:"ISOLATED",injectImmediately:!0})}var re={"echo::sender":(e,t)=>t,"log::getLogs":E,"settings::get":v,"settings::update":([e])=>N(e),"api::fetchStatus":I,"api::getCachedStatus":O,"api::recognition":([e])=>H(e),"tab::getCurrentId":g,"tab::getCurrentJSON":j,"tab::getCurrentURL":U,"tab::getURL":D,"tab::registerDetectedCaptcha":T,"tab::getDetectedCaptchas":C,"fetch::universalFetch":V,"fetch::asData":W,"tab::broadcast":([e])=>J(e),"locator::inject":(e,t)=>X(t?.tab?.id)};s.runtime.onMessage.addListener((e,t,o)=>{let r=e[1],a=re[r];return Promise.resolve(a(e.slice(2),t)).then(i=>{o([L(e[0]),i])}).catch(i=>{console.error(`[@nope/background/rpc] [${r}] errored!`,e.slice(2),i),o([L(e[0]),""+i])}),!0});})();
